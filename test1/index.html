<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>首页</title>
		<script src="js/mui.min.js"></script>
		<script src="js/vue.min.js"></script>
		<script src="js/properties.js"></script>
		<script src="js/axios.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="fonts/font_tuoke/iconfont.ttf">
		<style>
			html,
			body {
				background-color: #efeff4;
				height: 100%;
			}
			
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
				padding-bottom: 51px;
			}
		</style>
	</head>

	<body>
		<div id="app" class="mui-content" style="display:flex; flex-direction: column; align-items: center; height: 100%; overflow: scroll; padding-bottom: 70px; box-sizing: border-box;">
			<div class="mui-slider" style="height: 25%; width: 100%;" >
				<div class="mui-slider-group" style="width: 100%; height: 100%;" >
					<div class="mui-slider-item"><a href="#" style="width: 100%; height: 100%;" ><img src="images/1.png" style="width: 100%; height: 100%;"/></a></div>
					<div class="mui-slider-item"><a href="#" style="width: 100%; height: 100%;" ><img src="images/2.jpg" style="width: 100%; height: 100%;"/></a></div>
					<div class="mui-slider-item"><a href="#" style="width: 100%; height: 100%;" ><img src="images/3.png" style="width: 100%; height: 100%;"/></a></div>
					<div class="mui-slider-item"><a href="#" style="width: 100%; height: 100%;" ><img src="images/4.jpg" style="width: 100%; height: 100%;"/></a></div>
				</div>
			  	<div class="mui-slider-indicator">  
					<div class="mui-indicator mui-active"></div>  
					<div class="mui-indicator"></div>  
					<div class="mui-indicator"></div>  
					<div class="mui-indicator"></div>  
				</div>  
			</div>
			
			<div style="display: flex; flex-direction: column; height: 75%; width: 100%;">
				<div style="display: flex; height:25%; width: 100%; margin-top: 10px; font-size: 15px; color: white;">
					<div id="search" style="width: 40%; height: 100%; background: #398EF4; margin-right:3px;">
						<div style="padding: 10px; ">
							精准查找
						</div>
					</div>
					<div id="searchWechatGroup" style="width: 30%; height: 100%; background: #7379E7; margin-right:3px;">
						<div style="padding: 10px; ">
							精准微信群
						</div>
					</div>
					<div id="exportPhone" style="width: 30%; height: 100%; background: #9457F3; ">
						<div style="padding: 10px; ">
							手机号导出
						</div>
					</div>
				</div>
				
				<div style="display: flex; height: 30%; width: 100%; margin-top: 3px; font-size: 15px; color: white;">
					<div id="sendFlashSms" style="width: 40%; height: 100%; background: #16C3D8; margin-right:3px;">
						<div style="padding: 10px; ">
							闪信群发
						</div>
					</div>
					<div id="vipCenter" style="width: 30%; height: 100%; background: #E6F8FF;  color: #FF981A; margin-right:3px;">
						<div style="padding: 10px; ">
							VIP中心
						</div>
					</div>
					<div id="sendSms" style="width: 30%; height: 100%; background: #FF6778;">
						<div style="padding: 10px; ">
							短信群发
						</div>
					</div>
				</div>
				<div id="taskCenter" style="display: flex; height: 25%; width: 100%; margin-top: 3px; font-size: 15px; color: white;">
					<div style="width: 35%; height: 100%; background: #83CF1E; margin-right:3px;">
						<div style="padding: 10px; ">
							任务中心
						</div>
					</div>
					<div id="rechargeCredit" style="width: 65%; height: 100%; background: #27AA3B;">
						<div style="padding: 10px; ">
							积分充值
						</div>
					</div>
				</div>
				<div id="putAd" style="display: flex; height: 20%; width: 100%; margin-top: 3px; font-size: 15px; color: white;">
					<div style="width: 55%; height: 100%; background: #F3B41A; margin-right:3px;">
						<div style="padding: 10px; ">
							千站广告投放
						</div>
					</div>
					<div id="robot" style="width: 45%; height: 100%; background: #FF854B;">
						<div style="padding: 10px; ">
							精准电话机器人
						</div>
					</div>
				</div>
							
			</div>
		</div>

		<script src="js/util.js"></script>
		<script type="text/javascript">
			function init() {
				var self = plus.webview.currentWebview(),
					leftPos = Math.ceil((window.innerWidth - 60) / 2); // 设置凸起大图标为水平居中
				
				/**	
				 * drawNativeIcon 绘制带边框的半圆，
				 * 实现原理：
				 *   id为bg的tag 创建带边框的圆
				 *   id为bg2的tag 创建白色矩形遮住圆下半部分，只显示凸起带边框部分
				 * 	 id为iconBg的红色背景图
				 *   id为icon的字体图标
				 *   注意创建先后顺序，创建越晚的层级越高
				 */
				var drawNativeIcon = util.drawNative('icon', {
					bottom: '5px',
					left: leftPos + 'px',
					width: '60px',
					height: '60px'
				}, [{
					tag: 'rect',
					id: 'bg',
					position: {
						top: '1px',
						left: '0px',
						width: '100%',
						height: '100%'
					},
					rectStyles: {
						color: '#fff',
						radius: '50%',
						borderColor: '#ccc',
						borderWidth: '1px'
					}
				}, {
					tag: 'rect',
					id: 'bg2',
					position: {
						bottom: '-0.5px',
						left: '0px',
						width: '100%',
						height: '45px'
					},
					rectStyles: {
						color: '#fff'
					}
				}, {
					tag: 'rect',
					id: 'iconBg',
					position: {
						top: '5px',
						left: '5px',
						width: '50px',
						height: '50px'
					},
					rectStyles: {
						color: '#B40020',
						radius: '50%'
					}
				}, {
					tag: 'font',
					id: 'icon',
					text: '\ue604', //此为字体图标Unicode码'\e600'转换为'\ue600'
					position: {
						top: '0px',
						left: '5px',
						width: '50px',
						height: '100%'
					},
					textStyles: {
						fontSrc: '_www/fonts/iconfont.ttf',
						align: 'center',
						color: '#fff',
						size: '30px'
					}
				}]);
				// append 到父webview中
				self.append(drawNativeIcon);
					// 创建子webview窗口 并初始化
				var aniShow = {};
				util.initSubpage(aniShow);
				var 	nview = plus.nativeObj.View.getViewById('tabBar'),
					activePage = plus.webview.currentWebview(),
					targetPage,
					subpages = util.options.subpages,
					pageW = window.innerWidth,
					currIndex = 0;
					
				//自定义监听图标点击事件
				var active_color = '#fff';
				drawNativeIcon.addEventListener('click', function(e) {
					// mui.alert('你点击了图标，你在此可以打开摄像头或者新窗口等自定义点击事件。', '悬浮球点击事件');
					// 重绘字体颜色
					// if(active_color == '#fff') {
					// 	drawNativeIcon.drawText('\ue600', {}, {
					// 		fontSrc: '_www/fonts/iconfont.ttf',
					// 		align: 'center',
					// 		color: '#fff',
					// 		size: '30px'
					// 	}, 'icon');
					// 	active_color = '#000';
					// } else {
					// 	drawNativeIcon.drawText('\ue600', {}, {
					// 		fontSrc: '_www/fonts/iconfont.ttf',
					// 		align: 'center',
					// 		color: '#fff',
					// 		size: '30px'
					// 	}, 'icon');
					// 	active_color = '#fff';
					// }
					;
					targetPage = plus.webview.getWebviewById(subpages[3]);
					if(activePage === targetPage) {
						return;
					}
					//底部选项卡切换
					util.toggleNview(10);
					// // 子页面切换
					util.changeSubpage(targetPage, activePage, aniShow);
					// //更新当前活跃的页面
					activePage = targetPage;
								
				});
				// 中间凸起图标绘制及监听点击完毕
				
								
				
					
				/**
				 * 根据判断view控件点击位置判断切换的tab
				 */
				nview.addEventListener('click', function(e) {
					var clientX = e.clientX;
					if(clientX > 0 && clientX <= parseInt(pageW * 0.25)) {
						currIndex = 0;
					} else if(clientX > parseInt(pageW * 0.25) && clientX <= parseInt(pageW * 0.45)) {
						currIndex = 1;
					} else if(clientX > parseInt(pageW * 0.45) && clientX <= parseInt(pageW * 0.8)) {
						currIndex = 2;
					} else {
						currIndex = 3;
					}
					// 匹配对应tab窗口	
					if(currIndex > 0) {
						targetPage = plus.webview.getWebviewById(subpages[currIndex - 1]);
					} else {
						targetPage = plus.webview.currentWebview();
					}
				
					if(targetPage == activePage) {
						return;
					}
					//底部选项卡切换
					util.toggleNview(currIndex);
					// 子页面切换
					util.changeSubpage(targetPage, activePage, aniShow);
					//更新当前活跃的页面
					activePage = targetPage;
					
				});
				
				document.getElementById("searchWechatGroup").addEventListener("click", function() {
					
					targetPage = plus.webview.getWebviewById(subpages[0]);
					activePage = plus.webview.currentWebview();
					//底部选项卡切换
					util.toggleNview(1);
					// 子页面切换
					util.changeSubpage(targetPage, activePage, aniShow);
					//更新当前活跃的页面
					activePage = targetPage;
				})
				
				document.getElementById("search").addEventListener("click", function() {
					
					targetPage = plus.webview.getWebviewById(subpages[3]);
					activePage = plus.webview.currentWebview();
					//底部选项卡切换
					util.toggleNview(10);
					// 子页面切换
					util.changeSubpage(targetPage, activePage, aniShow);
					//更新当前活跃的页面
					activePage = targetPage;
				})
				
				document.getElementById("exportPhone").addEventListener("click", function() {
					
					targetPage = plus.webview.getWebviewById(subpages[3]);
					activePage = plus.webview.currentWebview();
					//底部选项卡切换
					util.toggleNview(10);
					// 子页面切换
					util.changeSubpage(targetPage, activePage, aniShow);
					//更新当前活跃的页面
					activePage = targetPage;
				})
				
				document.getElementById("sendFlashSms").addEventListener("click", function() {
					
					targetPage = plus.webview.getWebviewById(subpages[1]);
					activePage = plus.webview.currentWebview();
					//底部选项卡切换
					util.toggleNview(2);
					// 子页面切换
					util.changeSubpage(targetPage, activePage, aniShow);
					//更新当前活跃的页面
					activePage = targetPage;
				})
				document.getElementById("sendSms").addEventListener("click", function() {
					
					targetPage = plus.webview.getWebviewById(subpages[1]);
					activePage = plus.webview.currentWebview();
					//底部选项卡切换
					util.toggleNview(2);
					// 子页面切换
					util.changeSubpage(targetPage, activePage, aniShow);
					//更新当前活跃的页面
					activePage = targetPage;
				})
				
				document.getElementById("taskCenter").addEventListener("click", function() {
					
					targetPage = plus.webview.getWebviewById(subpages[1]);
					activePage = plus.webview.currentWebview();
					//底部选项卡切换
					util.toggleNview(2);
					// 子页面切换
					util.changeSubpage(targetPage, activePage, aniShow);
					//更新当前活跃的页面
					activePage = targetPage;
				})
				
				document.getElementById("rechargeCredit").addEventListener("click", function() {
					var w = plus.webview.create('html/rechargeCredit.html', 'rechargeCredit', {}, {});
					w.show("slide-in-right");
				})
			}
			(function() {
				mui.init({
					swipeBack: true //启用右滑关闭功能
				});
				var app = new Vue({
					el: '#app',
					data: {
						hotIndustryList: []
					}
				});
				mui.plusReady(function() {
					window.addEventListener('loginSuccess', function(e){
						init();
					});
					if(localStorage.token == null || localStorage.token == '') {
						var w = plus.webview.create('html/login.html', 'new', {}, {});
						w.show("slide-in-right", 150);
						return;
					} else {
						axios({
							method: "POST",
							url: server + "/user/getUserInfo",
							data: {},
							headers: {
								"Content-Type": "application/json",
								"token": localStorage.getItem("token")
							}
						}).then(function(res) {
							if(!res.data.success) {
								var w = plus.webview.create('html/login.html', 'new', {}, {});
								w.show("slide-in-right", 150);
								return;
							} else {
								localStorage.setItem("userStr", JSON.stringify(res.data.data));
								init();
							}
						});
						
					}
				});
			})();
		</script>
	</body>

</html>